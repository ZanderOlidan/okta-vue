{"version":3,"file":"okta-vue.umd.js","sources":["../../src/components/LoginCallback.vue","../../src/okta-vue.js"],"sourcesContent":["/*!\n * Copyright (c) 2017-Present, Okta, Inc. and/or its affiliates. All rights reserved.\n * The Okta software accompanied by this notice is provided pursuant to the Apache License, Version 2.0 (the \"License.\")\n *\n * You may obtain a copy of the License at http://www.apache.org/licenses/LICENSE-2.0.\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS, WITHOUT\n * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n *\n * See the License for the specific language governing permissions and limitations under the License.\n */\n\n\n<script>\nexport default {\n  name: 'LoginCallback',\n  async beforeMount () {\n    await this.$auth.handleLoginRedirect()\n  },\n  render () {}\n}\n</script>\n","/*!\n * Copyright (c) 2017-Present, Okta, Inc. and/or its affiliates. All rights reserved.\n * The Okta software accompanied by this notice is provided pursuant to the Apache License, Version 2.0 (the \"License.\")\n *\n * You may obtain a copy of the License at http://www.apache.org/licenses/LICENSE-2.0.\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS, WITHOUT\n * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n *\n * See the License for the specific language governing permissions and limitations under the License.\n */\n\n/* global PACKAGE */\nimport { toRelativeUrl, AuthSdkError } from '@okta/okta-auth-js'\n\n// constants are defined in webpack.config.js\nconst packageInfo = PACKAGE\n\nfunction install (Vue, {\n  oktaAuth,\n  onAuthRequired\n} = {}) {\n  if (!oktaAuth) {\n    throw AuthSdkError('No oktaAuth instance passed to OktaVue.')\n  }\n\n  // customize user agent\n  oktaAuth.userAgent = `${packageInfo.name}/${packageInfo.version} ${oktaAuth.userAgent}`\n\n  // add default restoreOriginalUri callback\n  let router\n  if (!oktaAuth.options.restoreOriginalUri) {\n    oktaAuth.options.restoreOriginalUri = async (_, originalUri) => {\n      // If a router is available, provide a default implementation\n      if (router) {\n        const path = toRelativeUrl(originalUri, window.location.origin)\n        return router.replace({ path })\n      }\n    }\n  }\n\n  let originalUriTracker\n  const guardSecureRoute = async (authState) => {\n    if (!authState.isAuthenticated) {\n      oktaAuth.setOriginalUri(originalUriTracker)\n      if (onAuthRequired) {\n        await onAuthRequired(oktaAuth)\n      } else {\n        await oktaAuth.signInWithRedirect()\n      }\n    }\n  }\n\n  Vue.mixin({\n    data () {\n      return {\n        authState: oktaAuth.authStateManager.getAuthState()\n      }\n    },\n    created () {\n      // assign router for the default restoreOriginalUri callback\n      router = this.$router\n\n      // subscribe to the latest authState\n      oktaAuth.authStateManager.subscribe(this.$_oktaVue_handleAuthStateUpdate)\n      if (!oktaAuth.token.isLoginRedirect()) {\n        // trigger an initial change event to make sure authState is latest\n        oktaAuth.authStateManager.updateAuthState()\n      }\n    },\n    beforeDestroy () {\n      oktaAuth.authStateManager.unsubscribe(this.$_oktaVue_handleAuthStateUpdate)\n    },\n    // \"beforeRouteEnter\" does NOT have access to `this` component instance\n    async beforeRouteEnter (to, _, next) {\n      const isRouteProtected = !to.matched.some(record => record.meta.allowUnauthed);\n      if (isRouteProtected) {\n        // track the originalUri for guardSecureRoute\n        originalUriTracker = to.fullPath\n\n        // subscribe to authState change to protect secure routes when authState change\n        // all secure routes should subscribe before enter the route\n        oktaAuth.authStateManager.subscribe(guardSecureRoute)\n\n        // guard the secure route based on the authState when enter\n        const isAuthenticated = await oktaAuth.isAuthenticated()\n        if (!isAuthenticated) {\n          const authState = oktaAuth.authStateManager.getAuthState()\n          await guardSecureRoute(authState)\n        } else {\n          next()\n        }\n      } else {\n        next()\n      }\n    },\n    beforeRouteLeave (to, from, next) {\n      oktaAuth.authStateManager.unsubscribe(guardSecureRoute)\n      next()\n    },\n    // private property naming convention follows\n    // https://vuejs.org/v2/style-guide/#Private-property-names-essential\n    methods: {\n      async $_oktaVue_handleAuthStateUpdate (authState) {\n        this.authState = Object.assign(this.authState, authState)\n      }\n    }\n  })\n\n  // add oktaAuth instance to Vue\n  Vue.prototype.$auth = oktaAuth\n}\n\nexport default { install }\n\nexport { default as LoginCallback } from './components/LoginCallback.vue'\n"],"names":["name","async","this","$auth","handleLoginRedirect","render","packageInfo","install","Vue","router","originalUriTracker","oktaAuth","onAuthRequired","AuthSdkError","userAgent","options","restoreOriginalUri","_","originalUri","path","toRelativeUrl","window","location","origin","replace","guardSecureRoute","authState","isAuthenticated","setOriginalUri","signInWithRedirect","mixin","data","authStateManager","getAuthState","created","$router","subscribe","$_oktaVue_handleAuthStateUpdate","token","isLoginRedirect","updateAuthState","beforeDestroy","unsubscribe","beforeRouteEnter","to","next","matched","some","record","meta","allowUnauthed","fullPath","beforeRouteLeave","from","methods","_this","Object","assign","prototype"],"mappings":"inBAce,CACbA,KAAM,gBACNC,0BACQC,KAAKC,MAAMC,uBAEnBC,sDCHIC,mBAAAA,gBAiGS,CAAEC,QA/FjB,SAAkBC,OAYZC,IAWAC,2DApBF,GAFFC,IAAAA,SACAC,IAAAA,mBAEKD,QACGE,eAAa,2CAIrBF,EAASG,oBAAeR,cAAoBA,cAAuBK,EAASG,WAIvEH,EAASI,QAAQC,qBACpBL,EAASI,QAAQC,iDAAqB,WAAOC,EAAGC,6FAE1CT,yBACIU,EAAOC,gBAAcF,EAAaG,OAAOC,SAASC,0BACjDd,EAAOe,QAAQ,CAAEL,KAAAA,sGAMxBM,gCAAmB,WAAOC,sFACzBA,EAAUC,mCACbhB,EAASiB,eAAelB,IACpBE,kCACIA,EAAeD,gDAEfA,EAASkB,6GAKrBrB,EAAIsB,MAAM,CACRC,sBACS,CACLL,UAAWf,EAASqB,iBAAiBC,iBAGzCC,mBAEEzB,EAASP,KAAKiC,QAGdxB,EAASqB,iBAAiBI,UAAUlC,KAAKmC,iCACpC1B,EAAS2B,MAAMC,mBAElB5B,EAASqB,iBAAiBQ,mBAG9BC,yBACE9B,EAASqB,iBAAiBU,YAAYxC,KAAKmC,kCAGvCM,0BAAkBC,EAAI3B,EAAG4B,6IACHD,EAAGE,QAAQC,MAAK,SAAAC,UAAUA,EAAOC,KAAKC,yCAG9DxC,EAAqBkC,EAAGO,SAIxBxC,EAASqB,iBAAiBI,UAAUX,YAGNd,EAASgB,2DAE/BD,EAAYf,EAASqB,iBAAiBC,yBACtCR,EAAiBC,mCAEvBmB,oCAGFA,mDAGJO,0BAAkBR,EAAIS,EAAMR,GAC1BlC,EAASqB,iBAAiBU,YAAYjB,GACtCoB,KAIFS,QAAS,CACDjB,yCAAiCX,6IACrC6B,EAAK7B,UAAY8B,OAAOC,OAAOF,EAAK7B,UAAWA,oDAMrDlB,EAAIkD,UAAUvD,MAAQQ"}