{"version":3,"file":"okta-vue.cjs.js","sources":["../../src/components/LoginCallback.vue","../../src/okta-vue.js"],"sourcesContent":["/*!\n * Copyright (c) 2017-Present, Okta, Inc. and/or its affiliates. All rights reserved.\n * The Okta software accompanied by this notice is provided pursuant to the Apache License, Version 2.0 (the \"License.\")\n *\n * You may obtain a copy of the License at http://www.apache.org/licenses/LICENSE-2.0.\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS, WITHOUT\n * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n *\n * See the License for the specific language governing permissions and limitations under the License.\n */\n\n\n<script>\nexport default {\n  name: 'LoginCallback',\n  async beforeMount () {\n    await this.$auth.handleLoginRedirect()\n  },\n  render () {}\n}\n</script>\n","/*!\n * Copyright (c) 2017-Present, Okta, Inc. and/or its affiliates. All rights reserved.\n * The Okta software accompanied by this notice is provided pursuant to the Apache License, Version 2.0 (the \"License.\")\n *\n * You may obtain a copy of the License at http://www.apache.org/licenses/LICENSE-2.0.\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS, WITHOUT\n * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n *\n * See the License for the specific language governing permissions and limitations under the License.\n */\n\n/* global PACKAGE */\nimport { toRelativeUrl, AuthSdkError } from '@okta/okta-auth-js'\n\n// constants are defined in webpack.config.js\nconst packageInfo = PACKAGE\n\nfunction install (Vue, {\n  oktaAuth,\n  onAuthRequired\n} = {}) {\n  if (!oktaAuth) {\n    throw AuthSdkError('No oktaAuth instance passed to OktaVue.')\n  }\n\n  // customize user agent\n  oktaAuth.userAgent = `${packageInfo.name}/${packageInfo.version} ${oktaAuth.userAgent}`\n\n  // add default restoreOriginalUri callback\n  let router\n  if (!oktaAuth.options.restoreOriginalUri) {\n    oktaAuth.options.restoreOriginalUri = async (_, originalUri) => {\n      // If a router is available, provide a default implementation\n      if (router) {\n        const path = toRelativeUrl(originalUri, window.location.origin)\n        return router.replace({ path })\n      }\n    }\n  }\n\n  let originalUriTracker\n  const guardSecureRoute = async (authState) => {\n    if (!authState.isAuthenticated) {\n      oktaAuth.setOriginalUri(originalUriTracker)\n      if (onAuthRequired) {\n        await onAuthRequired(oktaAuth)\n      } else {\n        await oktaAuth.signInWithRedirect()\n      }\n    }\n  }\n\n  Vue.mixin({\n    data () {\n      return {\n        authState: oktaAuth.authStateManager.getAuthState()\n      }\n    },\n    created () {\n      // assign router for the default restoreOriginalUri callback\n      router = this.$router\n\n      // subscribe to the latest authState\n      oktaAuth.authStateManager.subscribe(this.$_oktaVue_handleAuthStateUpdate)\n      if (!oktaAuth.token.isLoginRedirect()) {\n        // trigger an initial change event to make sure authState is latest\n        oktaAuth.authStateManager.updateAuthState()\n      }\n    },\n    beforeDestroy () {\n      oktaAuth.authStateManager.unsubscribe(this.$_oktaVue_handleAuthStateUpdate)\n    },\n    // \"beforeRouteEnter\" does NOT have access to `this` component instance\n    async beforeRouteEnter (to, _, next) {\n      const isRouteProtected = !to.matched.some(record => record.meta.allowUnauthed);\n      if (isRouteProtected) {\n        // track the originalUri for guardSecureRoute\n        originalUriTracker = to.fullPath\n\n        // subscribe to authState change to protect secure routes when authState change\n        // all secure routes should subscribe before enter the route\n        oktaAuth.authStateManager.subscribe(guardSecureRoute)\n\n        // guard the secure route based on the authState when enter\n        const isAuthenticated = await oktaAuth.isAuthenticated()\n        if (!isAuthenticated) {\n          const authState = oktaAuth.authStateManager.getAuthState()\n          await guardSecureRoute(authState)\n        } else {\n          next()\n        }\n      } else {\n        next()\n      }\n    },\n    beforeRouteLeave (to, from, next) {\n      oktaAuth.authStateManager.unsubscribe(guardSecureRoute)\n      next()\n    },\n    // private property naming convention follows\n    // https://vuejs.org/v2/style-guide/#Private-property-names-essential\n    methods: {\n      async $_oktaVue_handleAuthStateUpdate (authState) {\n        this.authState = Object.assign(this.authState, authState)\n      }\n    }\n  })\n\n  // add oktaAuth instance to Vue\n  Vue.prototype.$auth = oktaAuth\n}\n\nexport default { install }\n\nexport { default as LoginCallback } from './components/LoginCallback.vue'\n"],"names":["packageInfo","PACKAGE","install","Vue","oktaAuth","onAuthRequired","AuthSdkError","userAgent","name","version","router","options","restoreOriginalUri","_","originalUri","path","toRelativeUrl","window","location","origin","replace","originalUriTracker","guardSecureRoute","authState","isAuthenticated","setOriginalUri","signInWithRedirect","mixin","data","authStateManager","getAuthState","created","$router","subscribe","$_oktaVue_handleAuthStateUpdate","token","isLoginRedirect","updateAuthState","beforeDestroy","unsubscribe","beforeRouteEnter","to","next","isRouteProtected","matched","some","record","meta","allowUnauthed","fullPath","beforeRouteLeave","from","methods","Object","assign","prototype","$auth"],"mappings":"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"}